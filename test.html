<!doctype html>
<html>
  <meta charset="utf-8" />
  <title>Weather Test</title>
  <style>
    body{font-family:system-ui,sans-serif;max-width:760px;margin:24px auto;padding:0 16px}
    pre{background:#fafafa;border:1px solid #eee;padding:12px;overflow:auto}
    .ok{color:#0a7f2e}.err{color:#b00020}
  </style>
  <h1>Weather Test (auto-fetch Turin)</h1>
  <div id="status">Starting…</div>
  <h3>Result</h3>
  <pre id="out">—</pre>

  <script>
    // Use Hosting rewrite on hosted site; fallback to the deployed Function URL otherwise.
    const BASE = (location.hostname.endsWith('web.app') || location.hostname.endsWith('firebaseapp.com'))
      ? "/api/getWeather"
      : "https://europe-west1-weather-fns-demo-1.cloudfunctions.net/getWeather";

    // show any unexpected script errors directly on the page
    window.addEventListener('error', e => {
      document.getElementById('status').className = 'err';
      document.getElementById('status').textContent = 'Runtime error: ' + e.message;
    });

    (async () => {
      const status = document.getElementById('status');
      const out = document.getElementById('out');
  try {
        status.textContent = 'Fetching…';
  const url = BASE.startsWith('http') ? new URL(BASE) : new URL(BASE, location.origin);
        url.searchParams.set('city', 'Turin');

        const resp = await fetch(url.toString(), { method: 'GET' });
        const text = await resp.text(); // read raw so we always see something
        out.textContent = text;

        if (resp.ok) {
          status.className = 'ok';
          status.textContent = 'Success ✅';
        } else {
          status.className = 'err';
          status.textContent = `HTTP ${resp.status} ❌`;
        }
      } catch (err) {
        status.className = 'err';
        status.textContent = 'Fetch failed ❌ ' + (err && err.message ? err.message : String(err));
      }
    })();
  </script>
</html>